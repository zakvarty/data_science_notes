<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Code | Effective Data Science</title>
<meta name="author" content="Zak Varty">
<meta name="description" content="Effective Data Science is still a work-in-progress. This chapter should be readable but is currently undergoing final polishing. If you would like to contribute to the development of EDS, you may...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 4 Code | Effective Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://eds-book.zakvarty.com/workflows-code.html">
<meta property="og:image" content="https://eds-book.zakvarty.com/images/EDS-logo.jpg">
<meta property="og:description" content="Effective Data Science is still a work-in-progress. This chapter should be readable but is currently undergoing final polishing. If you would like to contribute to the development of EDS, you may...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Code | Effective Data Science">
<meta name="twitter:description" content="Effective Data Science is still a work-in-progress. This chapter should be readable but is currently undergoing final polishing. If you would like to contribute to the development of EDS, you may...">
<meta name="twitter:image" content="https://eds-book.zakvarty.com/images/EDS-logo.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Effective Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About this Course</a></li>
<li class="book-part">Effective Data Science Workflows</li>
<li><a class="" href="workflows-introduction.html">Introduction</a></li>
<li><a class="" href="workflows-organising-your-work.html"><span class="header-section-number">2</span> Organising your work</a></li>
<li><a class="" href="workflows-naming.html"><span class="header-section-number">3</span> Naming Files</a></li>
<li><a class="active" href="workflows-code.html"><span class="header-section-number">4</span> Code</a></li>
<li><a class="" href="workflows-checklist.html">Checklist</a></li>
<li class="book-part">Acquiring and Sharing Data</li>
<li><a class="" href="data-introduction.html">Introduction</a></li>
<li><a class="" href="data-tabular.html"><span class="header-section-number">5</span> Tabular Data</a></li>
<li><a class="" href="data-webscraping.html"><span class="header-section-number">6</span> Web Scraping</a></li>
<li><a class="" href="data-apis.html"><span class="header-section-number">7</span> APIs</a></li>
<li><a class="" href="data-checklist.html">Checklist</a></li>
<li class="book-part">Data Exploration and Visualisation</li>
<li><a class="" href="edav-introduction.html">Introduction</a></li>
<li><a class="" href="edav-wrangling.html"><span class="header-section-number">9</span> Data Wrangling</a></li>
<li><a class="" href="edav-analysis.html"><span class="header-section-number">10</span> Exploratory Data Analysis</a></li>
<li><a class="" href="edav-visualisation.html"><span class="header-section-number">11</span> Data Visualisation</a></li>
<li><a class="" href="edav-checklist.html">Checklist</a></li>
<li class="book-part">Preparing for Production</li>
<li><a class="" href="production-introduction.html">Introduction</a></li>
<li><a class="" href="production-reproducibility.html"><span class="header-section-number">12</span> Reproducibility</a></li>
<li><a class="" href="production-explainability.html"><span class="header-section-number">13</span> Explainability</a></li>
<li><a class="" href="production-scalability.html"><span class="header-section-number">14</span> Scalability</a></li>
<li><a class="" href="production-checklist.html">Checklist</a></li>
<li class="book-part">Data Science Ethics</li>
<li><a class="" href="ethics-introduction.html">Introduction</a></li>
<li><a class="" href="ethics-privacy.html"><span class="header-section-number">16</span> Privacy</a></li>
<li><a class="" href="ethics-fairness.html"><span class="header-section-number">17</span> Fairness</a></li>
<li><a class="" href="ethics-conduct.html"><span class="header-section-number">18</span> Codes of Conduct</a></li>
<li><a class="" href="ethics-checklist.html">Checklist</a></li>
<li><a class="" href="reading-list.html"><span class="header-section-number">19</span> Reading List</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/zakvarty/data_science_notes/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflows-code" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Code<a class="anchor" aria-label="anchor" href="#workflows-code"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdnote">
<p>Effective Data Science is still a work-in-progress. This chapter should be readable but is currently undergoing final polishing.</p>
<p>If you would like to contribute to the development of EDS, you may do so at <a href="https://github.com/zakvarty/data_science_notes" class="uri">https://github.com/zakvarty/data_science_notes</a>.</p>
</div>
<div id="introduction-1" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>We have already described how we might organise an effective data science project at the directory and file level. In this chapter we will delve one step deeper and consider how we can structure our work within those files. In particular, we‚Äôll focus on code files here.</p>
<p>We‚Äôll start by comparing the two main approaches to structuring our code, namely functional programming and object oriented programming.</p>
<p>We‚Äôll then see how we should order code within our scripts and conventions on how to name the functions and objects that we work with in our code.</p>
<p>Rounding up this chapter, I‚Äôll summarise the main points from the R style guide that we will be following in this course and highlight some useful packages for writing effective code.</p>
</div>
<div id="functional-programming" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Functional Programming<a class="anchor" aria-label="anchor" href="#functional-programming"><i class="fas fa-link"></i></a>
</h2>
<p>A functional programming style has two major properties:</p>
<ul>
<li><p>Object immutability,</p></li>
<li><p>Complex programs written using function composition.</p></li>
</ul>
<p>Firstly, the original data or objects aren‚Äôt modified or altered by the code. We have met this idea before when making new, cleaner versions of our raw data but leave that original messy data intact. Object immutability is the exact same idea but in a code context rather than data context.</p>
<p>Secondly, In functional programming, complex problems are solved by decomposing them into a series of smaller problems. A separate, self-contained function is then written to solve each sub-problem. Each individual function is, in itself, simple and easy to understand. This makes these small functions easy to test and easy to reuse in many places. Code complexity is then built up by composing these functions in various ways.</p>
<p>It can be difficult to get into this way of thinking, but people with mathematical training often find it quite natural. This is because mathematicians have many years of experience in working with function compositions in the abstract, mathematical sense.</p>
<p><span class="math display">\[y = g(x) = f_3 \circ f_2 \circ f_1(x).\]</span></p>
<div id="the-pipe-operator" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> The Pipe Operator<a class="anchor" aria-label="anchor" href="#the-pipe-operator"><i class="fas fa-link"></i></a>
</h3>
<p>One issue with functional programming is that lots of nested functions means that there are also lots of nested brackets. These start to get tricky to keep track of when you have upwards of 3 functions being composed. This reading difficulty is only exacerbated if your functions have additional arguments on top of the original inputs.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>The pipe operator <code>%&gt;%</code> from the <a href="https://magrittr.tidyverse.org">magrittr</a> package helps with this issue. It works exactly like function composition: it takes the whatever is on the left (whether that is an object or the output of a function) and passes it to the following function call as the first argument of that function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">pi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span></code></pre></div>
<p>The pipe operator is often referred to as ‚Äúsyntactic sugar‚Äù. This is because it doesn‚Äôt add anything to your code in itself but rather it makes your code <em>so</em> much more palatable.</p>
<p>In R versions 4.1 and greater, there‚Äôs a built-in version of this pipe operator, which is written using the vertical bar symbol followed by a greater than sign. To type the vertical bar, you can usually find it found above backslash on the keyboard.</p>
<p>(Just to cause confusion, the vertical bar symbol is also called the pipe symbol in general programming contexts. )</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">pi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span></code></pre></div>
<p>The base R pipe usually behaves in the same way as the pipe from magrittr, but there are a few cases where they differ. For reasons of back-compatibility and consistency we‚Äôll stick to the magrittr pipe in this course.</p>
</div>
<div id="when-not-to-pipe" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> When not to pipe<a class="anchor" aria-label="anchor" href="#when-not-to-pipe"><i class="fas fa-link"></i></a>
</h3>
<div class="medium_right">
<div class="inline-figure"><img src="images/103-organising-your-code/ceci-nest-pas-un-pipe.png" alt="Magrittr package logo: a humorous adaptation of Magritte's 'Ceci n'est pas une pipe'"></div>
</div>
<p>Pipes are designed to put focus on the the actions you are performing rather than the object that you are preforming those operations on. This means that there are two cases where you should almost certainly not use a pipe.</p>
<p>The first of these is when you need to manipulate more than one object at a time. Using secondary objects as reference points (but leaving them unchanged) is of course perfectly fine, but pipes should be used when applying a sequence of steps to create a new, modified version of one primary object.</p>
<p>Secondly, just because you <em>can</em> chain together many actions into a single pipeline, that doesn‚Äôt mean that you necessarily should. Very long sequences of piped operations are easier to read than nested functions, however they still burden the reader with the same cognitive load on their short term memory. Be kind and create meaningful, intermediate objects with informative names. This‚Äôll help the reader to more easily understand the logic within your code.</p>
</div>
</div>
<div id="object-oriented-programming" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Object Oriented Programming<a class="anchor" aria-label="anchor" href="#object-oriented-programming"><i class="fas fa-link"></i></a>
</h2>
<p>The main alternative to functional programming is object oriented programming.</p>
<ul>
<li>Solve problems by using lots of simple objects</li>
<li>R has 3 OOP systems: S3, S4 and R6.</li>
<li>Objects belong to a class, have methods and fields.</li>
<li>Example: agent based simulation of beehive.</li>
</ul>
<div id="oop-philosophy" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> OOP Philosophy<a class="anchor" aria-label="anchor" href="#oop-philosophy"><i class="fas fa-link"></i></a>
</h3>
<p>In functional programming, we solve complicated problems by using lots of simple functions. In object oriented programming we solve complicated problems using lots of simple objects. Which of these programming approaches is best will depend on the particular type of problem that you are trying to solve.</p>
<p>Functional programming is excellent for most types of data science work. Object oriented comes into its own when your problem has many small components interacting with one another. This makes it great for things like designing agent-based simulations, which I‚Äôll come back to in a moment.</p>
<p>In R there are three different systems for doing object oriented programming (called S3, S4, and R6), so things can get a bit complicated. We won‚Äôt go into detail about them here, but I‚Äôll give you an overview of the main ideas.</p>
<p>This approach to programming might be useful for you in the future, for example if you want to extend base R functions to work with new types of input, and to have user-friendly displays. In that case (Advanced R)[<a href="https://adv-r.hadley.nz/" class="uri">https://adv-r.hadley.nz/</a>] by Hadley Wickham is an excellent reference text.</p>
<p>In OOP, each object belongs to a class and has a set of methods associated with it. The class defines what an object <em>is</em> and methods describe what that object can <em>do</em>. On top of that, each object has class-specific attributes or data fields. These fields are shared by all objects in a class but the values that they take give information about that specific object.</p>
</div>
<div id="oop-example" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> OOP Example<a class="anchor" aria-label="anchor" href="#oop-example"><i class="fas fa-link"></i></a>
</h3>
<div class="medium_right">
<div class="inline-figure"><img src="images/103-organising-your-code/beehive_3.jpg" alt="Italian Trulli"></div>
</div>
<p>This is is all sounding very abstract. Let‚Äôs consider writing some object oriented code to simulate a beehive. Each object will be a bee, and each bee is an instance of one of three bee classes: it might be a queen, a worker or a drone for example. Different bee classes have different methods associated with them, which describe what the bee can do, for example all bees would have 6 methods that let them move up, down, left, right, forward and backward within the hive. An additional ‚Äúreproduce‚Äù method might only be defined for queen bees and a pollinate method might only be defined for workers. Each instance of a bee has its own fields, which give data about that specific bee. All bees have x, y and z coordinate fields giving their location within the hive. The queen class might have an additional field for their number of offspring and the workers might have an additional field for how much pollen they are carrying.</p>
<p>As the simulation progresses, methods are applied to each object altering their fields and potentially creating or destroying objects. This is very different from the preservation mindset of functional programming, but hopefully you can see that it is a very natural approach to many types of problem.</p>
</div>
</div>
<div id="structuring-r-script-headers" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Structuring R Script Headers<a class="anchor" aria-label="anchor" href="#structuring-r-script-headers"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>TL;DR
- Start script with a comment of 1-2 sentences explaining what it &gt; does.
- <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code> and <code>rm(ls())</code> are the devil‚Äôs work.
- ‚ÄúSession‚Äù &gt; ‚ÄúRestart R‚Äù or Keyboard shortcut: crtl/cmd + shift &gt; + 0
- Polite to gather all <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> and <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> calls.
- Rude to mess with other people‚Äôs set up using &gt; <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.
- Portable scripts use paths relative to the root directory of the project.</p>
</blockquote>
<p>First things first, let‚Äôs discuss what should be at the top of your R scripts.</p>
<p>It is almost always a good idea to start your file with a few commented out sentences describing the purpose of the script and, if you work in a large team, perhaps who contact with any questions about this script. (There is more on comments coming up soon, don‚Äôt worry!)</p>
<p>It is also good practise to move all <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> and <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> calls to the top of your script. These indicate the packages and helper function that are dependencies of your script; it‚Äôs useful to know what you need to have installed before trying to run any code.</p>
<p>That segues nicely to the next point, which is never to hard code package installations. It is extremely bad practise and very rude to do so because then your script might alter another person‚Äôs R installation. If you don‚Äôt know already, this is precisely the difference between an <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> and <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> call: <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> will download the code for that package to the users computer, while <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> takes that downloaded code and makes it available in the current R session. To avoid messing with anyone‚Äôs R installation, you should always type <code>install.package()</code> commands directly in the console and then place the corresponding <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> calls within your scripts.</p>
<p>Next, it is likely that you, or someone close to you, will commit the felony of starting every script by setting the working directory and clearing R‚Äôs global environment. This is <em>very</em> bad practice, it‚Äôs indicative of a workflow that‚Äôs not project based and it‚Äôs problematic for at least two reasons. Firstly, the path you set will likely not work on anyone else‚Äôs computer. Secondly, clearing the environment like this may <em>look</em> like it gets you back to fresh, new R session but all of your previously loaded packages will still be loaded and lurking in the background.</p>
<p>Instead, to achieve your original aim of starting a new R session, go to the menu and select the ‚ÄúSession‚Äù drop down then select ‚ÄúRestart R‚Äù. Alternatively, you can use keyboard shortcuts to do the same. This is ‚Äúcrtl + shift + 0‚Äù on Windows and ‚Äúcmd + shift + 0‚Äù on a mac. The fact that a keyboard shortcut exists for this should quite strongly hint that, in a reproducible and project oriented workflow, you should be restarting R quite often in an average working day. This is the scripting equivalent of ‚Äúclear all output and rerun all‚Äù in a notebook.</p>
<p>Finally, let‚Äôs circle back to the point I made earlier about setting the working directory. The reason that this will not work is because you are likely giving file paths that are specific to your computer, your operating system and your file organisation system. The chances of someone else having all of these the same are practically zero.</p>
</div>
<div id="portable-file-paths-with-here" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Portable File paths with <code>{here}</code><a class="anchor" aria-label="anchor" href="#portable-file-paths-with-here"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bad - breaks if project moved</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"zaks-mbp/Desktop/exciting-new-project/src/helper_functions/rolling_mean.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Better - breaks if Windows</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"../../src/helper_functions/rolling_mean.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Best - but use here:here() to check root directory correctly identified</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"src"</span>,<span class="st">"helper_functions"</span>,<span class="st">"rolling_mean.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For more info on the here package:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">"here"</span><span class="op">)</span></span></code></pre></div>
<p>To fix the problem of person- and computer-specific file paths you can have two options.</p>
<p>The first is to use <em>relative</em> file paths. In this you assume that each R script is being run in its current location and my moving up and down through the levels of your project directory you point to the file that you need.</p>
<p>This is good in that it solves the problem of paths breaking because you move the project to a different location on your own laptop. However, it does not fully solve the portability problem because you might move your file to a different location <em>within</em> the same project. It also does not solve the problem that windows uses MacOS and linux use forward slashes in file paths with widows uses backslashes.</p>
<p>To resolve these final two issues I recommend using the <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> function from the {here} package. This package looks for a <code>.Rproj</code> or <code>.git</code> file to identify the root directory of your project and creates file paths relative to the root of your project, that are suitable for the operating system the code is being run on.</p>
<p>It really is quite marvellous. For more information on how to use the here package, explore its chapter in <a href="https://rstats.wtf/project-oriented-workflow.html" title="rstats.wtf/project-oriented-workflow">R - What They Forgot</a>, <a href="https://r4ds.had.co.nz/workflow-projects.html">R for Data Science</a> or this <a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/" title="Tidyverse blog: workflow-vs-script">project oriented workflow blog post</a>.</p>
</div>
<div id="code-body" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Code Body<a class="anchor" aria-label="anchor" href="#code-body"><i class="fas fa-link"></i></a>
</h2>
<p>Moving on now, we will go from the head to the body of the code. Having well named and organised code will facilitate both reading and understanding. Comments and sectioning do the rest of this work.</p>
<p>This section is designed as an introduction to the <a href="https://style.tidyverse.org/">tidyverse style guide</a> and not as a replacement to it.
### Comments</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is an example script showing good use of comments and sectioning </span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"src"</span>,<span class="st">"helper_functions"</span>,<span class="st">"rolling_mean.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#===============================================================================  &lt;- 80 characters max for readability</span></span>
<span><span class="co"># Major Section on Comments ----</span></span>
<span><span class="co">#===============================================================================</span></span>
<span></span>
<span><span class="co">#-------------------------------------------------------------------------------</span></span>
<span><span class="co">##  Minor Section on inline comments ---- </span></span>
<span><span class="co">#-------------------------------------------------------------------------------</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="co"># this is an inline comment</span></span>
<span></span>
<span><span class="co">#-------------------------------------------------------------------------------</span></span>
<span><span class="co">##  Minor Section on full line comments ---- </span></span>
<span><span class="co">#-------------------------------------------------------------------------------</span></span>
<span><span class="fu">rolling_mean</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># This is an full line comment</span></span></code></pre></div>
<p>Comments may be either short in-line comments at the end of a line or full lines dedicated to comments. To create either type of comment in R, simply type hash followed by one space. The rest of that line will not be evaluated and will function as a comment. If multi-line comments are needed simply start multiple lines with a hash and a space.</p>
<p>The purpose of these comments is to explain the <em>why</em> of what you are doing, not the what. If you are explaining <em>what</em> you are doing in most of your comments then you perhaps need to consider writing more informative function names, something we will return to in the general advice section.</p>
<p>Comments can also be used to add structure to your code, buy using commented lines of hyphens and equal signs to chunk your files into minor and major sections.</p>
<p>Markdown-like section titles can be added to these section and subsection headers. Many IDEs, such as RStudio, will interpret these as a table of contents for you, so that you can more easily navigate your code.</p>
<div id="objects-are-nouns" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Objects are Nouns<a class="anchor" aria-label="anchor" href="#objects-are-nouns"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Object names should use only lowercase letters, numbers, and <code>_</code>.</p></li>
<li><p>Use underscores (<code>_</code>) to separate words within a name. (<code>snake_case</code>)</p></li>
<li><p>Use nouns, preferring singular over plural names.</p></li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="va">day_one</span></span>
<span><span class="va">day_1</span></span>
<span></span>
<span><span class="co"># Bad</span></span>
<span><span class="va">first_day_of_the_month</span></span>
<span><span class="va">DayOne</span></span>
<span><span class="va">dayone</span></span>
<span><span class="va">djm1</span></span></code></pre></div>
<p>When creating and naming objects a strong guideline in that objects should be named using short but meaningful nouns. Names should not include any special characters and should use underscores to separate words within the object name.</p>
<p>This is similar to our file naming guide, but note that hyphens can‚Äôt be used in object names because this conflicts with the subtraction operator.</p>
<p>When naming objects, as far as possible use singular nouns. The main reason for this is that the plurisation rules in English are complex and will eventually trip up either you or a user of your code.</p>
</div>
<div id="functions-are-verbs" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> Functions are Verbs<a class="anchor" aria-label="anchor" href="#functions-are-verbs"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p>Function names should use only lowercase letters, numbers, and <code>_</code>.</p></li>
<li><p>Use underscores (<code>_</code>) to separate words within a name. (<code>snake_case</code>)</p></li>
<li><p>Suggest imperative mood, as in a recipe.</p></li>
<li><p>Break long functions over multiple lines. 4 vs 2 spaces.</p></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good</span></span>
<span><span class="fu">add_row</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">permute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bad</span></span>
<span><span class="fu">row_adder</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">permutation</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">long_function_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">a</span> <span class="op">=</span> <span class="st">"a long argument"</span>,</span>
<span>    <span class="va">b</span> <span class="op">=</span> <span class="st">"another argument"</span>,</span>
<span>    <span class="va">c</span> <span class="op">=</span> <span class="st">"another long argument"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># As usual code is indented by two spaces.</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The guidelines for naming functions are broadly similar, with the advice that functions should be verbs rather than nouns.</p>
<p>Functions should be named in the imperative mood, like in a recipe. This is again for consistency; having function names in a range of moods and tenses leads to coding nightmares.</p>
<p>As with object names you should aim to give your functions and their arguments short, evocative names. For functions with many arguments or a long name, you might not be able to fit the function definition on a single line. In this case you can should place each argument on its own double indented line and the function body on a single indented line.</p>
</div>
<div id="casing-consistantly" class="section level3" number="4.6.3">
<h3>
<span class="header-section-number">4.6.3</span> Casing Consistantly<a class="anchor" aria-label="anchor" href="#casing-consistantly"><i class="fas fa-link"></i></a>
</h3>
<p>As we have mentioned already, we have many options for separating words within names:</p>
<ul>
<li><code>CamelCase</code></li>
<li><code>pascalCase</code></li>
<li><code>snakecase</code></li>
<li>
<code>underscore_separated</code> ‚ù§Ô∏è</li>
<li><code>hyphen-separated</code></li>
<li>
<code>point.separated</code> üíÄ</li>
</ul>
<p>For people used to working in Python it is tempting to use point separation in function names, in the spirit of methods from object oriented programming. Indeed, some base R functions even use this convention.</p>
<p>However, the reason that we advise against it is because it is already used for methods in some of R‚Äôs inbuilt OOP functionality. We will use underscore separation in our work.</p>
</div>
<div id="style-guide-summary" class="section level3" number="4.6.4">
<h3>
<span class="header-section-number">4.6.4</span> Style Guide Summary<a class="anchor" aria-label="anchor" href="#style-guide-summary"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Use comments to structure your code</li>
<li>Objects = Nouns</li>
<li>Functions = Verbs</li>
<li>Use snake case and consistant grammar</li>
</ol>
</div>
</div>
<div id="further-tips-for-friendly-coding" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Further Tips for Friendly Coding<a class="anchor" aria-label="anchor" href="#further-tips-for-friendly-coding"><i class="fas fa-link"></i></a>
</h2>
<p>In addition to naming conventions the style guide gives lots of other guidance on writing code in a way that is kind to future readers of that code.</p>
<p>I‚Äôm not going to go repeat all of that guidance here, but the motivation for all of these can be boiled down into the following points.</p>
<ul>
<li><p>Write your code to be easily understood by humans.</p></li>
<li><p>Use informative names, typing is cheap.</p></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bad</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">dmt</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Good</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">temperature</span> <span class="kw">in</span> <span class="va">daily_max_temperature</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>Divide your work into logical stages, human memory is expensive.</li>
</ul>
<p>When writing your code, keep that future reader in mind. This means using names that are informative and reasonably short, it also means adding white space, comments and formatting to aid comprehension. Adding this sort of structure to your code also helps to reduce the cognitive burden that you are placing on the human reading your code.</p>
<p>Informative names are more important than short names. This is particularly true when using flow controls, which are things like for loops and while loops. Which of these for loops would you like to encounter when approaching a deadline or urgently fixing a bug? Almost surely the second one, where context is immediately clear.</p>
<p>A computer doesn‚Äôt care if you call a variable by only a single letter, by a random key smash (like <code>aksnbioawb</code>) or by an informative name. A computer also doesn‚Äôt care if you include no white space your code - the script will still run. However, doing these things are friendly practices that can help yourself when debugging and your co-workers when collaborating.</p>
</div>
<div id="reduce-reuse-recycle" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Reduce, Reuse, Recycle<a class="anchor" aria-label="anchor" href="#reduce-reuse-recycle"><i class="fas fa-link"></i></a>
</h2>
<p>In this final section, we‚Äôll look at how you can make your workflow more efficient by reducing the amount of code you write, as well as reusing and recycling code that you‚Äôve already written.</p>
<div id="dry-coding" class="section level3" number="4.8.1">
<h3>
<span class="header-section-number">4.8.1</span> DRY Coding<a class="anchor" aria-label="anchor" href="#dry-coding"><i class="fas fa-link"></i></a>
</h3>
<p>This idea of making your workflow more efficient by reducing, reusing and recycling your code is summarised by the DRY acronym: don‚Äôt repeat yourself.</p>
<p>This can be boiled down to three main points:</p>
<blockquote>
<ul>
<li>if you do something twice in a single script, then write a function to do that thing,</li>
<li>if you want to use your function elsewhere <em>within</em> your project, then save it in a separate script</li>
<li>If you want to use your function <em>across</em> projects, then add it to a package.</li>
</ul>
</blockquote>
<p>Of course, like with scoping projects in the first place, this requires some level of clairvoyance: you have to be able to look into the future and see whether you‚Äôll use a function in another script or project. This is difficult, bordering on impossible. So in practice, this is done retrospectively - you find a second script or project that needs a function then pull it out its own separate file or include it in a package.</p>
<p>As a rule of thumb, if you are having to consider whether or not to make the function more widely available then you should do it. It takes much less effort to do this work now, while it‚Äôs fresh in your mind, than to have to refamiliarise yourself with the code in several years time.</p>
<p>Let‚Äôs now look at how to implement those sub-bullet points:
‚Äúwhen you write a function, document it‚Äù and ‚Äúwhen you write a function, test it‚Äù.</p>
</div>
<div id="rememer-how-to-use-your-own-code" class="section level3" number="4.8.2">
<h3>
<span class="header-section-number">4.8.2</span> Rememer how to use your own code<a class="anchor" aria-label="anchor" href="#rememer-how-to-use-your-own-code"><i class="fas fa-link"></i></a>
</h3>
<p>When you come to use a function written by somebody else, you likely have to refer to their documentation to teach or to remind yourself of things like what the expected inputs are and how exactly the method is implemented.</p>
<p>When writing your own functions you should create documentation that fills the same need. Even if the function is just for personal use, over time you‚Äôll forget exactly how it works.</p>
<blockquote>
<p><em>When you write a function, document it.</em></p>
</blockquote>
<p>But what should that documentation contain?</p>
<ul>
<li>Inputs</li>
<li>Outputs</li>
<li>Example use cases</li>
<li>Author (if not obvious or working in a team)</li>
</ul>
<p>Your documentation should describe the inputs and outputs of your function, some simple example uses. If you are working in a large team, the documentation should also indicate who wrote the function and who‚Äôs responsible for maintaining it over time.</p>
</div>
<div id="roxygen2-for-documentation" class="section level3" number="4.8.3">
<h3>
<span class="header-section-number">4.8.3</span> <code>{roxygen2}</code> for documentation<a class="anchor" aria-label="anchor" href="#roxygen2-for-documentation"><i class="fas fa-link"></i></a>
</h3>
<p>In the same way that we used the <a href="https://here.r-lib.org/">here</a> package to simplify our file path problems, we‚Äôll use the <a href="https://roxygen2.r-lib.org/">roxygen2</a> package to simplify our testing workflow.</p>
<p>The {roxygen2} package gives us an easily insert-able temple for documenting our functions. This means we don‚Äôt have to waste our time and energy typing out and remembering boilerplate code. It also puts our documentation in a format that allows us to get hints and auto-completion for our own functions, just like the functions we use from packages that are written by other people.</p>
<p>To use Roxygen, you only need to install it once - it doesn‚Äôt need to be loaded with a library call at the top of your script. After you‚Äôve done this, and with your cursor inside a function definition, you can then insert skeleton code to document that function in one of two ways: you can either use the Rstudio menu or the keyboard short cut for your operating system.</p>
<ol style="list-style-type: decimal">
<li><code>install.packages("roxygen2")</code></li>
<li>With cursor inside function: Code &gt; Insert Roxygen Skeleton</li>
<li>Keyboard shortcut: <em>cmd + option + shift + r</em> or <em>crtl + option + shift + r</em>
</li>
<li>Fill out relevant fields</li>
</ol>
</div>
<div id="an-roxygen2-example" class="section level3" number="4.8.4">
<h3>
<span class="header-section-number">4.8.4</span> An <code>{roxygen2}</code> example<a class="anchor" aria-label="anchor" href="#an-roxygen2-example"><i class="fas fa-link"></i></a>
</h3>
<p>Below, we‚Äôve got an example of an Roxygen skeleton to document a function that calculates the geometric mean of a vector. Here, the hash followed by an apostrophe is a special type of comment. It indicates that this is function documentation rather than just a regular comment.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Title</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x </span></span>
<span><span class="co">#' @param remove_NA </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="va">geometric_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">remove_NA</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Function body goes here</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We‚Äôll fill in all of the fields in this skeleton apart from export, which we‚Äôll remove. If we put this function in a R package, then the export field makes it available to users of that package. Since this is just a standalone function we won‚Äôt need the export field, though keeping it wouldn‚Äôt actually cause us any problems either.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Calculate the geometric mean of a numeric vector</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x numeric vector</span></span>
<span><span class="co">#' @param remove_NA logical scalar, indicating whether NA values should be stripped before computation proceeds. </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return the geometric mean of the values in `x`, a numeric scalar value. </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' geometric_mean(x = 1:10)</span></span>
<span><span class="co">#' geometric_mean(x = c(1:10, NA), remove_NA = TRUE)</span></span>
<span><span class="co">#' </span></span>
<span><span class="va">geometric_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">remove_NA</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Function body goes here</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once we have filled in the skeleton documentation it might look something like this. We have described what the function does, what the expected inputs are and what the user can expect as an output. We‚Äôve also given an few simple examples of how the function can be used.</p>
<p>For more on Roxygen, see the <a href="https://roxygen2.r-lib.org/">package documentation</a> or the chapter of R packages on <a href="https://r-pkgs.org/man.html">function documentation</a>.</p>
</div>
<div id="checking-your-code" class="section level3" number="4.8.5">
<h3>
<span class="header-section-number">4.8.5</span> Checking Your Code<a class="anchor" aria-label="anchor" href="#checking-your-code"><i class="fas fa-link"></i></a>
</h3>
<blockquote>
<p><em>If you write a function, test it.</em></p>
</blockquote>
<p>Testing code has two main purposes:</p>
<ul>
<li>To warn or prevent user misuse (e.g.¬†strange inputs),</li>
<li>To catch edge cases.</li>
</ul>
<p>On top of explaining how our functions <em>should</em> work, we really ought to check that they <em>do</em> work. This is the job of unit testing.</p>
<p>Whenever you write a function you should test that it works as you intended it to. Additionally, you should test that your function is robust to being misused by the user. Depending on the context, this might be accidental or malicious misuse. Finally, you should check that the function behaves properly for strange, but still valid, inputs. These are known as edge cases.</p>
<p>Testing can be a bit of a brutal process, you‚Äôve just created a beautiful function and now you‚Äôre job is to do your best to break it!</p>
</div>
<div id="an-informal-testing-workflow" class="section level3" number="4.8.6">
<h3>
<span class="header-section-number">4.8.6</span> An Informal Testing Workflow<a class="anchor" aria-label="anchor" href="#an-informal-testing-workflow"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Write a function</li>
<li>Experiment with the function in the console, try to break it</li>
<li>Fix the break and repeat.</li>
</ol>
<p><strong>Problems:</strong> Time consuming and not reproducible.</p>
<p>An informal approach to testing your code might be to first write a function and then play around with it in the console to check that it behaves well when you give it obvious inputs, edge cases and deliberately wrong inputs. Each time you manage to break the function, you edit it to fix the problem and then start the process all over again.</p>
<p>This <em>is</em> testing the code, but only informally. There‚Äôs no record of how you have tried to break your code already. The problem with this approach is that when you return to this code to add a new feature, you‚Äôll probably have forgotten at least one of the informal tests you ran the first time around. This goes against our efforts towards reproducibility and automation. It also makes it very easy to break code that used to work just fine.</p>
</div>
<div id="a-formal-testing-workflow" class="section level3" number="4.8.7">
<h3>
<span class="header-section-number">4.8.7</span> A Formal Testing Workflow<a class="anchor" aria-label="anchor" href="#a-formal-testing-workflow"><i class="fas fa-link"></i></a>
</h3>
<p>We can formalise this testing workflow by writing our tests in their own R script and saving them for future reference. Remember from the first lecture that these should be saved in the <code>tests/</code> directory, the structure of which should mirror that of the <code>src/</code> directory for your project. All of the tests for one function should live in a single file, which is named after that function.</p>
<p>One way of writing these tests is to use lots of if statements. The <a href="https://testthat.r-lib.org">testthat</a> can do some of that syntactic heavy lifting for us. It has lots of helpful functions to test that the output of your function is what you expect.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geometric_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span> , <span class="va">remove_NA</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="fu">geometric_mean</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, remove_NA <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  expected <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Error: geometric_mean(x = c(1, NA), remove_NA = FALSE) not equal to NA.</span></span>
<span><span class="co"># Types not compatible: double is not logical</span></span></code></pre></div>
<p>In this example, we have an error because our function returns a logical <code>NA</code> rather than a double <code>NA</code>. Yes, R really does have different types of <code>NA</code> for different types of missing data, it usually just handles these nicely in the background for you.</p>
<p>This subtle difference is probably not something that you would have spotted on your own, until it caused you trouble much further down the line. This rigorous approach is one of the benefits of of using the <a href="https://testthat.r-lib.org">testthat</a> functions.</p>
<p>To fix this test we change out expected output to <code>NA_real_</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="fu">geometric_mean</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="cn">NA</span><span class="op">)</span>, remove_NA <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  expected <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span></span></code></pre></div>
<p>We‚Äôll revisit the <a href="https://testthat.r-lib.org">testthat</a> package in the live session this week, when we will learn how to use it to test functions within our own packages.</p>
</div>
</div>
<div id="summary-1" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> Summary<a class="anchor" aria-label="anchor" href="#summary-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Functional and Object Oriented Programming</li>
<li>Structuring your scripts</li>
<li>Styling your code</li>
<li>Reduce, reuse, recycle</li>
<li>Documenting and testing</li>
</ul>
<p>Let‚Äôs wrap up by summarising what we have learned in this chapter.</p>
<p>We started out with a discussion on the differences between functional and object oriented programming. While R is capable of both, data science work tends to have more of a functional flavour to it.</p>
<p>We‚Äôve then described how to structure your scripts and style your code to make it as human-friendly and easy to debug as possible.</p>
<p>Finally, we discussed how to write DRY code that is well documented and tested.</p>

<!-- Placeholder section to be added for 20223/24 cohort -->
<!-- 
# Project Management {#workflows-project-management}


::: {.rmdimportant} 
Effective Data Science is still a work-in-progress. This chapter is currently a dumping ground for ideas, and we don't recommend reading it. 

If you would like to contribute to the development of EDS, you may do so at <https://github.com/zakvarty/data_science_notes>.
:::

## Bigger Picture: Project management

- Project management 
  - Defining outcomes 
  - scoping projects, (rememberer how we said all code for a single project should live in a single directory?)
  - continuous development, agile + jira ?
  - Linking to github (extension)
-->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="workflows-naming.html"><span class="header-section-number">3</span> Naming Files</a></div>
<div class="next"><a href="workflows-checklist.html">Checklist</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflows-code"><span class="header-section-number">4</span> Code</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">4.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#functional-programming"><span class="header-section-number">4.2</span> Functional Programming</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-pipe-operator"><span class="header-section-number">4.2.1</span> The Pipe Operator</a></li>
<li><a class="nav-link" href="#when-not-to-pipe"><span class="header-section-number">4.2.2</span> When not to pipe</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#object-oriented-programming"><span class="header-section-number">4.3</span> Object Oriented Programming</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#oop-philosophy"><span class="header-section-number">4.3.1</span> OOP Philosophy</a></li>
<li><a class="nav-link" href="#oop-example"><span class="header-section-number">4.3.2</span> OOP Example</a></li>
</ul>
</li>
<li><a class="nav-link" href="#structuring-r-script-headers"><span class="header-section-number">4.4</span> Structuring R Script Headers</a></li>
<li><a class="nav-link" href="#portable-file-paths-with-here"><span class="header-section-number">4.5</span> Portable File paths with {here}</a></li>
<li>
<a class="nav-link" href="#code-body"><span class="header-section-number">4.6</span> Code Body</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#objects-are-nouns"><span class="header-section-number">4.6.1</span> Objects are Nouns</a></li>
<li><a class="nav-link" href="#functions-are-verbs"><span class="header-section-number">4.6.2</span> Functions are Verbs</a></li>
<li><a class="nav-link" href="#casing-consistantly"><span class="header-section-number">4.6.3</span> Casing Consistantly</a></li>
<li><a class="nav-link" href="#style-guide-summary"><span class="header-section-number">4.6.4</span> Style Guide Summary</a></li>
</ul>
</li>
<li><a class="nav-link" href="#further-tips-for-friendly-coding"><span class="header-section-number">4.7</span> Further Tips for Friendly Coding</a></li>
<li>
<a class="nav-link" href="#reduce-reuse-recycle"><span class="header-section-number">4.8</span> Reduce, Reuse, Recycle</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dry-coding"><span class="header-section-number">4.8.1</span> DRY Coding</a></li>
<li><a class="nav-link" href="#rememer-how-to-use-your-own-code"><span class="header-section-number">4.8.2</span> Rememer how to use your own code</a></li>
<li><a class="nav-link" href="#roxygen2-for-documentation"><span class="header-section-number">4.8.3</span> {roxygen2} for documentation</a></li>
<li><a class="nav-link" href="#an-roxygen2-example"><span class="header-section-number">4.8.4</span> An {roxygen2} example</a></li>
<li><a class="nav-link" href="#checking-your-code"><span class="header-section-number">4.8.5</span> Checking Your Code</a></li>
<li><a class="nav-link" href="#an-informal-testing-workflow"><span class="header-section-number">4.8.6</span> An Informal Testing Workflow</a></li>
<li><a class="nav-link" href="#a-formal-testing-workflow"><span class="header-section-number">4.8.7</span> A Formal Testing Workflow</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summary-1"><span class="header-section-number">4.9</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/zakvarty/data_science_notes//blob/master/103-workflows-organising-your-code.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/zakvarty/data_science_notes//edit/master/103-workflows-organising-your-code.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Effective Data Science</strong>" was written by Zak Varty. It was last built on 2023-01-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
